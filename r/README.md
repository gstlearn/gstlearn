## Overview

The **gstlearn** R package is a cross-platform R package wrapping the [gstlearn C++ Library](https://github.com/gstlearn/gstlearn). It offers to R users **all famous Geostatistical methodologies** developped and/or invented by the Geostatistic Team of the [Geosciences Research Center](https://www.geosciences.minesparis.psl.eu/)!

Copyright (c) MINES PARIS / PSL University

All *gstlearn* outputs can be ploted using *plot* generic function which relies on *ggplot* package.


## References

The R *gstlearn* package is a R wrapper of the [gstlearn C++ Library](https://github.com/gstlearn/gstlearn).

This package contains a modified copy of [findR.cmake](https://github.com/root-project/root) script (see LICENSE.root in *root* folder).

The *gstlearn* R package is a derivative work based on the *swigex* project: [https://github.com/fabien-ors/swigex](https://github.com/fabien-ors/swigex)


## Installation

For using this R Package you only need R 4 (or higher) and execute the following R command:

    # TODO : Doesn't work yet
    #        Please, compile and install from source (see below)
    #
    # install.packages("gstlearn", repos="https://cg.ensmp.fr/cran")

## Usage

    # Load gstlearn package
    library(gstlearn)
    # Grid size
    nx = 60
    ny = 30
    mygrid = DbGrid_create(c(nx,ny))
    # Add a uniform random field
    var = VH_simulateUniform(nx * ny)
    mygrid$addColumns(var, "var1")
    # Display the field
    plot.grid(mygrid, "var1")

Some tutorials (RMarkdown) are provided in the [demo](https://github.com/gstlearn/gstlearn/tree/main/doc/demo/r) directory of the *gstlearn* github repository.

Some tests (R Scripts) are available in the [tests](https://github.com/gstlearn/gstlearn/tree/main/tests/r) directory of the *gstlearn* github repository.


## Documentation

The classes and functions documentation is provided with the gstlearn package as html files generated by Doxygen (optional). Please refer to *gstlearn* C++ library [README file](https://github.com/gstlearn/gstlearn) for more details. 


## Changelog

Please, look at [CHANGES file](https://github.com/gstlearn/gstlearn/blob/main/CHANGES).

## Developments

### Requirements

For building the *gstlearn* R package, the requirements for building *gstlearn C++ library* must be installed beforehand. Then, the following additional tools must be also available:

    * SWIG 4.2.0 **customized by Fabien Ors** (not the official version!)
    * R 4 or higher
    * RTools 4 or higher (for Windows users only)
    * *ggplot2* and *ggpubr* R packages [Optional] (only for plotting)

#### Linux (Ubuntu)

1. Install *gstlearn* C++ library requirements for Linux [here](https://github.com/gstlearn/gstlearn#Linux (Ubuntu))

2. Remove any previous installation of SWIG (if any)

3. Then, execute the following commands:

    sudo apt install r-base
    sudo apt install bison pcre2-devel # Ubuntu 18
    sudo apt install bison pcre2-dev # Ubuntu 20
    
4. In a folder of your own, compile and install SWIG 4.2.0 [customized] by executing following commands:

    git clone https://github.com/fabien-ors/swig.git
    cd swig
    cmake -Bbuild
    cd build
    make
    sudo make install

5. Finally, install the R required packages from an R command prompt (if you need to plot gstlearn output):

    install.packages(c("ggplot2", "ggpubr"), repos="https://cloud.r-project.org")

Notes:

* If your Linux distribution repository doesn't provide minimum required versions, please install the tools manually (see provider website)

#### MacOS

1. Install *gstlearn C++ library* requirements for MacOS [here](https://github.com/gstlearn/gstlearn#MacOS)

2. Remove any previous installation of SWIG (if any)

3. Then, execute the following commands (Not tested):

    brew install r
    brew install bison pcre2-devel

4. In a folder of your own, compile and install SWIG 4.2.0 [customized] by executing following commands:

    git clone https://github.com/fabien-ors/swig.git
    cd swig
    cmake -Bbuild
    cd build
    make
    make install
    
5. Finally, install the R required packages from an R command prompt (if you need to plot gstlearn output):

    install.packages(c("ggplot2", "ggpubr"), repos="https://cloud.r-project.org")

Notes:

* These instructions for MacOS are currently not tested - above packages may not exist
* If your MacOS distribution repository doesn't provide minimum required versions, please install the tools manually (see provider website)

#### Windows

1. Install *gstlearn C++ library* requirements for Windows (RTools) [here](https://github.com/gstlearn/gstlearn#Windows - MinGW (via RTools))

2. Remove any previous installation of SWIG (if any)

3. Then, from a MSYS2 shell command prompt, execute following instructions:

    pacman -Sy mingw-w64-x86_64-pcre2
    pacman -Sy bison
    
4. In a directory of your own, compile and install SWIG 4.2.0 [customized] by executing following commands:

    git clone https://github.com/fabien-ors/swig.git
    cd swig
    cmake -G "MSYS Makefiles" -Bbuild -DCMAKE_INSTALL_PREFIX:PATH=/mingw64/
    cd build
    make
    make install
    
5. Finally, install the R required packages from an R command prompt (if you need to plot *gstlearn* output):

    install.packages(c("ggplot2", "ggpubr"), repos="https://cloud.r-project.org")

### Installation from Source

1. For getting the *gstlearn* R package sources files, just clone the github repository:

    git clone https://github.com/gstlearn/gstlearn.git
    cd gstlearn
    
2. Then, these instructions will compile and install the *gstlearn* R package in your usual R libraries directory:

    cmake -Bbuild -H. -DCMAKE_BUILD_TYPE=Release
    cmake --build build --target r_install

or even faster:

    make r_install

Note :

* If you experience the following issue: `Error: ERROR: no permission to install to directory...`, we suggest you to run the `install.packages` command above (at least one time). This will create a *personal R library folder* having writing permissions.

### Execute Non-regression Tests

The `check.*` targets brings some required runtime customization, so do not use the standard *ctest* command for triggering the non-regression tests.
 
To build and launch non-regression R tests, execute the following command:

    cmake --build build --target check_r
    
or even faster:

    make check_r

### Important Notes

* Under Windows, using RTools is mandatory for compiling R packages
* Under Windows, you may need to add `-G "MSYS Makefiles"` to the first cmake command above
* If you want to build and install the *Debug* version, you must replace `Release` by `Debug` above
* You may need to precise the location of Boost, SWIG or HDF5 installation directory. In that case, add the following variables in the first command above (do not use Makefile shortcuts):
  * `-DBoost_ROOT=<path/to/boost>`
  * `-DSWIG_ROOT=<path/to/swig>`
  * `-DHDF5_ROOT=<path/to/hdf5>`

### Remove Installed Package

Execute the following command from an R command prompt:

    remove.packages("gstlearn")

---

## License

GPL v3
2022 Team gstlearn
